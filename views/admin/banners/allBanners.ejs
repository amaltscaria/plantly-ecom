<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Plantly Admin</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="/admin/assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="/admin/assets/vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="/admin/assets/vendors/jvectormap/jquery-jvectormap.css">
  <link rel="stylesheet" href="/admin/assets/vendors/flag-icon-css/css/flag-icon.min.css">
  <link rel="stylesheet" href="/admin/assets/vendors/owl-carousel-2/owl.carousel.min.css">
  <link rel="stylesheet" href="/admin/assets/vendors/owl-carousel-2/owl.theme.default.min.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="/admin/assets/css/style.css">
  <!-- End layout styles -->
  <link rel="shortcut icon" href="/admin/assets/images/favicon.png" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <style>
    /* Common Styles */
    .content-wrapper {
      margin-top: 35px;
    }

    .container-scroller {
      height: 100vh;
    }

    .table-responsive {
      overflow-y: hidden;
    }

    .btn-action {
      border: none;
      margin: 0 5px;
      color: #fff;
    }

    /* Table Styles */
    #bannerTable, #bannerTable1 {
      width: 80%;
      margin: 50px auto;
    }

    #bannerTable1 th,
    #bannerTable1 td {
      text-align: center;
    }

    #bannerTable1 th {
      background-color: #000000;
      color: #fff;
      padding: 15px;
    }

    #bannerTable1 td {
      padding: 10px;
    }

    /* Button Styles */
    .btn-edit {
      background-color: #000000;
      color: #ffffff;
    }

    .btn-edit:hover {
      background-color: #faff67;
    }

    /* Page Header Styles */
    .page-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .page-header-title {
      color: #28a745;
    }

    .btn-add-banner {
      background-color: #28a745;
    }

    .addBannerButton {
      position: relative;
      margin-right: 10%;
    }

    .user-message {
      margin: auto;
      width: 30%;
      padding: 1.2rem;
      border-radius: 3px;
      margin-bottom: 20px;
      border: 1px solid rgb(0, 255, 98);
      background-color: rgb(101, 255, 175);
      text-align: center;
    }

    .user-message-error {
      border-color: red;
      background: rgb(244, 187, 187);
      color: red;
    }

    .btn-list{
      background: rgb(59, 215, 59);
    }
  </style>

  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</head>

<body>
  <div class="container-scroller">
    <!-- partial:partials/_sidebar.html -->
    <nav class="sidebar sidebar-offcanvas" id="sidebar">
      <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
        <h1 class="text-white">Plantly</h1>
        <a class="sidebar-brand brand-logo-mini" href="index.html"><img src="/admin/assets/images/logo-mini.svg" alt="logo" /></a>
      </div>
      <ul class="nav">
        <li class="nav-item profile">
          <div class="profile-desc">
            <div class="profile-pic">
              <div class="count-indicator">
                <img class="img-xs rounded-circle " src="/admin/assets/images/dashboard/profile.jpeg" alt="">
                <span class="count bg-success"></span>
              </div>
              <div class="profile-name">
                <h5 class="mb-0 font-weight-normal text-white"><%=user.split('@')[0]%></h5>
                <span>Gold Member</span>
              </div>
            </div>
            <a href="#" id="profile-dropdown" data-toggle="dropdown"><i class="mdi mdi-dots-vertical"></i></a>
            <div class="dropdown-menu dropdown-menu-right sidebar-dropdown preview-list" aria-labelledby="profile-dropdown">
              <div class="dropdown-divider"></div>
              <div class="dropdown-divider"></div>
              <a href="/admin/logout" class="dropdown-item preview-item">
                <div class="preview-thumbnail">
                  <div class="preview-icon bg-dark rounded-circle">
                    <i class="mdi mdi-calendar-today text-success"></i>
                  </div>
                </div>
                <div class="preview-item-content">
                  <p class="preview-subject ellipsis mb-1 text-small">Logout</p>
                </div>
              </a>
            </div>
          </div>
        </li>
        <li class="nav-item nav-category">
          <span class="nav-link">Navigation</span>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" href="/admin/dashboard">
            <span class="menu-icon">
              <i class="mdi mdi-speedometer"></i>
            </span>
            <span class="menu-title">Dashboard</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" href="/admin/customers">
            <span class="menu-icon">
              <i class="fa-solid fa-users"></i>
            </span>
            <span class="menu-title">Users</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" data-toggle="collapse" href="#ui-basic" aria-expanded="false" aria-controls="ui-basic">
            <span class="menu-icon">
              <i class="fa-brands fa-product-hunt"></i>
            </span>
            <span class="menu-title">products</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="ui-basic">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href="/admin/products">All Products</a></li>
              <li class="nav-item"> <a class="nav-link" href="/admin/addProduct">Add Product</a></li>
            </ul>
          </div>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" data-toggle="collapse" href="#auth" aria-expanded="false" aria-controls="auth">
            <span class="menu-icon">
              <i class="mdi mdi-security"></i>
            </span>
            <span class="menu-title">Categories</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="auth">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href=""> All Categories </a></li>
              <li class="nav-item"> <a class="nav-link" href="/admin/addCategory"> Add Category </a></li>
            </ul>
          </div>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" href="pages/forms/basic_elements.html">
            <span class="menu-icon">
              <i class="mdi mdi-playlist-play"></i>
            </span>
            <span class="menu-title">Banners</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a
            class="nav-link"
            data-toggle="collapse"
            href="#coupons"
            aria-expanded="false"
            aria-controls="auth"
          >
            <span class="menu-icon">
              <i class="fa-solid fa-ticket"></i>
            </span>
            <span class="menu-title">Coupons</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="coupons">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item">
                <a class="nav-link" href="/admin/coupons">
                  All Coupons
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/admin/addCoupons">
                  Add Coupon
                </a>
              </li>
            </ul>
          </div>
        </li>
        <!-- <li class="nav-item menu-items">
            <a class="nav-link" href="pages/charts/chartjs.html">
              <span class="menu-icon">
                <i class="mdi mdi-chart-bar"></i>
              </span>
              <span class="menu-title">Charts</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="pages/icons/mdi.html">
              <span class="menu-icon">
                <i class="mdi mdi-contacts"></i>
              </span>
              <span class="menu-title">Icons</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="http://www.bootstrapdash.com/demo/corona-free/jquery/documentation/documentation.html">
              <span class="menu-icon">
                <i class="mdi mdi-file-document-box"></i>
              </span>
              <span class="menu-title">Documentation</span>
            </a>
          </li> -->
      </ul>
    </nav>

  <!-- ... (your existing code) ... -->

<!-- Banner Table -->
<div class="table-responsive m-0" id="bannerTable">
  <!-- Content area -->
  <div class="container-fluid page-body-wrapper">
    <div class="main-panel">
      <div class="content-wrapper bg-white pe-0">
        <!-- Add your existing content here -->
      
        <div class="user-message user-message-error" style="display: none;" id="listBanner"> Banner Unisted Successfully </div>
    
      
        <div class="user-message" style="display: none;" id="unlistBanner"> Banner listed successfully </div>
   

        <!-- Add Banner Button -->
        <div class="text-right mb-2 addBannerButton">
          <a class="btn btn-primary" href="/admin/addBanner">Add Banner</a>
        </div>

        <!-- Banner Table -->
        <div class="table-responsive" id="bannerTable1">
          <table class="table table-bordered" id="bannerTable2">
            <thead class="thead-light">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Banner Name</th>
                <th scope="col">Image</th>
                <th scope="col">Target ID</th>
                <th scope="col">Target Type</th>
                <th scope="col">Start Date</th>
                <th scope="col">End Date</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% for(let i = 0; i < banners.length; i++){%>
              <tr>
                <td><%=i+1%></td>
                <td><%=banners[i].bannerName%></td>
                <td><img src="/admin/assets/uploads/productImages/<%=banners[i].bannerImage%>%>" alt="Banner Image" style="max-width: 150px; max-height: 150px; width: 150px;height: 150px;"></td>
                <td><%=banners[i].targetId%></td>
                <td><%=banners[i].targetType%></td>
                <%
                const startDate = banners[i].startDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                  });
                  %>
                  <%
                  const endDate = banners[i].expiryDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    });
                    %>
                <td><%=startDate%></td>
                <td><%=endDate%></td>
               
                <td>
          
                    <%if(banners[i].isListed===true){%>
                    <button class="btn w-50 btn-list" onclick="UnlistBanner('<%= banners[i]._id %>','<%=banners[i].isListed%>')">Unlist</button>
                    <%}else{%>
                    <button class="btn w-50 btn-danger" onclick="UnlistBanner('<%= banners[i]._id %>','<%=banners[i].isListed%>')">list</button>
                    <%}%>
                    <a href="/admin/editBanner/<%=banners[i]._id%>" class="btn w-35 btn-edit">Edit</>
              

                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
      
      </div>
    </div>
  </div>
</div>
<!-- End Banner Table -->

<!-- ... (your existing code) ... -->

    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="/admin/assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="/admin/assets/vendors/chart.js/Chart.min.js"></script>
    <script src="/admin/assets/vendors/progressbar.js/progressbar.min.js"></script>
    <script src="/admin/assets/vendors/jvectormap/jquery-jvectormap.min.js"></script>
    <script src="/admin/assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="/admin/assets/vendors/owl-carousel-2/owl.carousel.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="/admin/assets/js/off-canvas.js"></script>
    <script src="/admin/assets/js/hoverable-collapse.js"></script>
    <script src="/admin/assets/js/misc.js"></script>
    <script src="/admin/assets/js/settings.js"></script>
    <script src="/admin/assets/js/todolist.js"></script>
    <script src="https://kit.fontawesome.com/34b95b40fc.js" crossorigin="anonymous"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="/admin/assets/js/dashboard.js"></script>
    <!-- End custom js for this page -->

    <!-- Unlist Category Modal -->
    <div class="modal fade" id="unlistCategoryModal" tabindex="-1" aria-labelledby="unlistCategoryModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="unlistCategoryModalLabel">list/Unlist Banner</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to make the selected changes?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" id="unListButton" class="btn btn-primary">Confirm</button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Unlist Category Modal -->


    <script>
      function editCategory(categoryName, id) {
        // When the button is clicked, set the value of the input field and show the modal
        document.getElementById('editedCategoryName').value = categoryName;
        $('#editCategoryModal').modal('show');
        // Add an event listener to the form for the submit event
        document.getElementById('editCategoryForm').addEventListener('submit', function(event) {
          submitEditCategoryForm(event, id);
        });
      }
      // Function to handle form submission
      function submitEditCategoryForm(event, id) {
        event.preventDefault(); // Prevent the default form submission

        // Get the updated category name from the input field
        const updatedCategoryName = document.getElementById('editedCategoryName').value;

        // Make a fetch request to update the category
        fetch(`/admin/editCategory/${id}`, {
            method: 'PATCH', // Use the PATCH method
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              updatedCategoryName: updatedCategoryName,
            }),
          })
          .then(response => response.json())
          .then(data => {
            console.log('Category updated successfully:', data);
            window.location.reload();
            // You can perform additional actions here after the category is updated

          })
          .catch(error => {
            console.error('Error updating category:', error);
            window.location.reload();
          })
          .finally(() => {
            // Close the modal after the request is complete
            $('#editCategoryModal').modal('hide');
          });
      }
    </script>
    <script>
      function UnlistBanner(id, isListed) {
        const unListButton = $('#unListButton');

        $('#unlistCategoryModal').modal('show');

        // Add a new click event listener
        unListButton.click((event)=>{
          unList(event, id);
        })
      }
      async function unList(event, id) {
        event.preventDefault();

        // Make a fetch request to update the banner 
        try {
          const response = await fetch(`/admin/listUnlistBanner/${id}`, {
            method: 'PATCH', // Use the PATCH method
            headers: {
              'Content-Type': 'application/json',
            },
          });
         

          if (response.status===200) {
          const message = await response.json();
          console.log(message);
          if(message.message=== 'listed'){
            const unListButton = $('#unListButton');
          $('#listBanner').css('display','block');
          setTimeout(()=>{
            $('#listBanner').css('display','none');
            $('#bannerTable2').load('/admin/banners #bannerTable2');
          },1500);
          unListButton.off('click');
          }
          if(message.message=== 'unlisted'){
            const unListButton = $('#unListButton');
          $('#unlistBanner').css('display','block');
          setTimeout(()=>{
            $('#unlistBanner').css('display','none');
            $('#bannerTable2').load('/admin/banners #bannerTable2');
          },1500);
          unListButton.off('click');
        }

          }
        } catch (error) {
          console.error('Error unlisting category:', error);
        } finally {
          // Close the modal after the request is complete
          $('#unlistCategoryModal').modal('hide');
        }
      }
    </script>
</body>

</html>