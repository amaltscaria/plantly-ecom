<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Plantly Admin</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="/admin/assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="/admin/assets/vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="/admin/assets/vendors/jvectormap/jquery-jvectormap.css">
  <link rel="stylesheet" href="/admin/assets/vendors/flag-icon-css/css/flag-icon.min.css">
  <link rel="stylesheet" href="/admin/assets/vendors/owl-carousel-2/owl.carousel.min.css">
  <link rel="stylesheet" href="/admin/assets/vendors/owl-carousel-2/owl.theme.default.min.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="/admin/assets/css/style.css">
  <!-- End layout styles -->
  <link rel="shortcut icon" href="/admin/assets/images/favicon.png" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <style>
    #coupon-edit-error{
    width: 311px;
    padding: 6px;
    margin-top: 25px;
    }
       input[type=number]::-webkit-inner-spin-button, 
         input[type=number]::-webkit-outer-spin-button {
         -webkit-appearance: none;
         margin: 0;
         }
    /* Table Styles */
    #couponTable {
      width: 75%;
      margin: 50px auto;
    }

    #couponTable th,
    #couponTable td {
      text-align: center;
    }

    #couponTable th {
      background-color: #000000;
      color: #fff;
      padding: 15px;
    }

    #couponTable td {
      padding: 10px;
    }

    /* Button Styles */
    .btn-unlist,
    .btn-list,
    .btn-danger,
    .btn-edit {
      min-width: 45% !important;
      border: none;
      margin: 0 5px;
      color: #fff;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .btn-unlist {
      background-color: #13e87a;
    }

    .btn-list:hover {
      background-color: #76f1b5;
    }

    .btn-danger {
      background-color: #dc3545;
    }

    .btn-danger:hover {
      background-color: #ff505f;
    }

    .btn-edit {
      background-color: #000000;
      color: #ffffff;
    }

    .btn-edit:hover {
      background-color: #faff67;
    }

    #listBtn {
      background: red;
    }

    .user-message {
      margin: auto;
      width: 30%;
      padding: 1.2rem;
      border-radius: 3px;
      margin-bottom: 20px;
      border: 1px solid rgb(0, 255, 98);
      background-color: rgb(101, 255, 175);
      text-align: center;
    }

    .user-message-error {
      border-color: red;
      background: rgb(244, 187, 187);
      color: red;
    }
  </style>

  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</head>

<body>
  <div class="container-scroller">
    <!-- partial:partials/_sidebar.html -->
    <nav class="sidebar sidebar-offcanvas" id="sidebar">
      <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
        <h1 class="text-white">Plantly</h1>
        <a class="sidebar-brand brand-logo-mini" href="index.html"><img src="/admin/assets/images/logo-mini.svg" alt="logo" /></a>
      </div>
      <ul class="nav">
        <li class="nav-item profile">
          <div class="profile-desc">
            <div class="profile-pic">
              <div class="count-indicator">
                <img class="img-xs rounded-circle " src="/admin/assets/images/dashboard/profile.jpeg" alt="">
                <span class="count bg-success"></span>
              </div>
              <div class="profile-name">
                <h5 class="mb-0 font-weight-normal text-white"><%=user.split('@')[0]%></h5>
                <span>Gold Member</span>
              </div>
            </div>
            <a href="#" id="profile-dropdown" data-toggle="dropdown"><i class="mdi mdi-dots-vertical"></i></a>
            <div class="dropdown-menu dropdown-menu-right sidebar-dropdown preview-list" aria-labelledby="profile-dropdown">
              <div class="dropdown-divider"></div>
              <div class="dropdown-divider"></div>
              <a href="/admin/logout" class="dropdown-item preview-item">
                <div class="preview-thumbnail">
                  <div class="preview-icon bg-dark rounded-circle">
                    <i class="mdi mdi-calendar-today text-success"></i>
                  </div>
                </div>
                <div class="preview-item-content">
                  <p class="preview-subject ellipsis mb-1 text-small">Logout</p>
                </div>
              </a>
            </div>
          </div>
        </li>
        <li class="nav-item nav-category">
          <span class="nav-link">Navigation</span>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" href="/admin/dashboard">
            <span class="menu-icon">
              <i class="mdi mdi-speedometer"></i>
            </span>
            <span class="menu-title">Dashboard</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" href="/admin/customers">
            <span class="menu-icon">
              <i class="fa-solid fa-users"></i>
            </span>
            <span class="menu-title">Users</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" data-toggle="collapse" href="#ui-basic" aria-expanded="false" aria-controls="ui-basic">
            <span class="menu-icon">
              <i class="fa-brands fa-product-hunt"></i>
            </span>
            <span class="menu-title">products</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="ui-basic">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href="/admin/products">All Products</a></li>
              <li class="nav-item"> <a class="nav-link" href="/admin/addProduct">Add Product</a></li>
            </ul>
          </div>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" data-toggle="collapse" href="#auth" aria-expanded="false" aria-controls="auth">
            <span class="menu-icon">
              <i class="mdi mdi-security"></i>
            </span>
            <span class="menu-title">Categories</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="auth">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href=""> All Categories </a></li>
              <li class="nav-item"> <a class="nav-link" href="/admin/addCategory"> Add Category </a></li>
            </ul>
          </div>
        </li>
        <li class="nav-item menu-items">
          <a class="nav-link" href="pages/forms/basic_elements.html">
            <span class="menu-icon">
              <i class="mdi mdi-playlist-play"></i>
            </span>
            <span class="menu-title">Banners</span>
          </a>
        </li>
        <li class="nav-item menu-items">
          <a
            class="nav-link"
            data-toggle="collapse"
            href="#coupons"
            aria-expanded="false"
            aria-controls="auth"
          >
            <span class="menu-icon">
              <i class="fa-solid fa-ticket"></i>
            </span>
            <span class="menu-title">Coupons</span>
            <i class="menu-arrow"></i>
          </a>
          <div class="collapse" id="coupons">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item">
                <a class="nav-link" href="">
                  All Coupons
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/admin/addCoupons">
                  Add Coupon
                </a>
              </li>
            </ul>
          </div>
        </li>
        <!-- <li class="nav-item menu-items">
            <a class="nav-link" href="pages/charts/chartjs.html">
              <span class="menu-icon">
                <i class="mdi mdi-chart-bar"></i>
              </span>
              <span class="menu-title">Charts</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="pages/icons/mdi.html">
              <span class="menu-icon">
                <i class="mdi mdi-contacts"></i>
              </span>
              <span class="menu-title">Icons</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="http://www.bootstrapdash.com/demo/corona-free/jquery/documentation/documentation.html">
              <span class="menu-icon">
                <i class="mdi mdi-file-document-box"></i>
              </span>
              <span class="menu-title">Documentation</span>
            </a>
          </li> -->
      </ul>
    </nav>

    <!-- Coupon Table (Hardcoded Data) -->
    <div class="table-responsive" id="couponTable">
      <div id="couponTable1">
        <div id="coupon-add" class="user-message" style="display: none;">Coupon Edited Successfully</div>

        <!-- Add Category Button -->
        <div class="text-right mb-2 addCategoryButton">
          <a class="btn btn-primary" href="/admin/addCoupons">Add Coupon</a>
        </div>
        <table class="table table-bordered" id="reloadTable">
          <thead class="thead-light">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Coupon Code</th>
              <th scope="col">Discount %</th>
              <th scope="col">Expiry</th>
              <th scope="col">Eligibility</th>
              <th scope="col">Min Purchase Amount</th>
              <th scope="col">Max Discount</th>
              <th scope="col">Available Count</th>
              <th scope="col">Category</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <%for(let i = 0; i < coupons.length; i++){%>
            <tr>
              <td><%=i+1%></td>
              <td><%=coupons[i].code%></td>
              <td><%=coupons[i].discountPercentage%>%</td>
              <%
              const date = coupons[i].expiresOn.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                });
                %>
              <td><%=date%></td>
              <td><%=coupons[i].eligibility%></td>
              <%if(coupons[i].eligibility!=='amount'){%>
              <td>Not Applicable</td>
              <%}else {%>
              <td>Rs. <%=coupons[i].criteriaValue%></td>
              <%}%>
              <td><%=coupons[i].maximumDiscount%></td>
              <td><%=coupons[i].availableCouponCount%></td>
              <%if(coupons[i].eligibility!=='category'){%>
              <td>Not Applicable</td>
              <%}else {%>
              <td><%=coupons[i].categorySelect%></td>
              <%}%>
              
              <td>

                <%if(coupons[i].isListed===true){%>
              <button class="btn w-25 btn-unlist text-black" id="unListBtn" onclick="listCoupon('<%=coupons[i]._id%>','unlist')">Unlist</button>
              <%}else{%>
              <button class="btn w-25 btn-list " id="listBtn" onclick="listCoupon('<%=coupons[i]._id%>','list')">list</button>
              <%}%>
                  <button class="btn w-25 btn-edit" id="couponEdit" onclick="editCoupon('<%=coupons[i]._id%>','<%=coupons[i].code%>',
                  '<%=coupons[i].discountPercentage%>','<%=coupons[i].description%>',
                  '<%=coupons[i].expiresOn%>','<%=coupons[i].eligibility%>','<%=coupons[i].criteriaValue%>','<%=coupons[i].categorySelect%>','<%=coupons[i].maximumDiscount%>','<%=coupons[i].availableCouponCount%>')">Edit</button>
              </td>
            </tr>
            <%}%>
              <!-- Add more rows as needed -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="/admin/assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="/admin/assets/vendors/chart.js/Chart.min.js"></script>
    <script src="/admin/assets/vendors/progressbar.js/progressbar.min.js"></script>
    <script src="/admin/assets/vendors/jvectormap/jquery-jvectormap.min.js"></script>
    <script src="/admin/assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="/admin/assets/vendors/owl-carousel-2/owl.carousel.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="/admin/assets/js/off-canvas.js"></script>
    <script src="/admin/assets/js/hoverable-collapse.js"></script>
    <script src="/admin/assets/js/misc.js"></script>
    <script src="/admin/assets/js/settings.js"></script>
    <script src="/admin/assets/js/todolist.js"></script>
    <script src="https://kit.fontawesome.com/34b95b40fc.js" crossorigin="anonymous"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="/admin/assets/js/dashboard.js"></script>
    <!-- End custom js for this page -->

    <!-- list/unlist coupon  Modal -->
    <div class="modal fade" id="listCoupon" tabindex="-1" aria-labelledby="unlistCategoryModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalHead"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p id="modalbody"></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" id="listModal" class="btn btn-primary"></button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Unlist Category Modal -->


<!-- Edit Coupon Modal -->
<div class="modal fade" id="editCouponModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Edit Coupon</h5><div id="coupon-edit-error" class="user-message user-message-error" style="display: none;">Coupon with this name already Exists</div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      
      <div class="modal-body">
        <!-- Edit Coupon Form -->
        <form id="editCouponForm">

          <!-- Coupon Code and Discount Percentage on the same line -->
          <div class="mb-4">
            <div class="row">
              <div class="col-md-6">
                <label for="editCouponCodeLabel" class="form-label">Coupon Code</label>
                <input type="text" class="form-control" name="couponCode" oninput="this.value = this.value.toUpperCase()" id="editCouponCodeLabel" placeholder="Coupon Code" aria-label="Coupon Code" />
                <div id="editCouponCodeError" class="text-danger"></div>
              </div>
              <div class="col-md-6">
                <label for="editDiscountPercentageLabel" class="form-label">Discount Percentage</label>
                <input type="number" class="form-control" name="discountPercentage" id="editDiscountPercentageLabel" placeholder="Discount Percentage" aria-label="Discount Percentage" />
                <div id="editDiscountPercentageError" class="text-danger"></div>
              </div>
            </div>
          </div>

         

          <!-- Expiry Date -->
          <div class="mb-4">
            <label for="editExpiryDateLabel" class="form-label">Expiry Date</label>
            <input type="date" class="form-control" name="expiryDate" id="editExpiryDateLabel" placeholder="Expiry Date" aria-label="Expiry Date" />
            <div id="editExpiryDateError" class="text-danger"></div>
          </div>

          <!-- Coupon Description -->
         <!-- Coupon Description -->
<div class="mb-4">
  <label for="editCouponDescription" class="form-label">Coupon Description</label>
  <textarea name="couponDescription" id="editCouponDescription" class="form-control" rows="2" placeholder="Type your coupon description..." aria-label="Coupon Description"></textarea>
  <div id="editCouponDescriptionError" class="text-danger"></div>
</div>
<!-- End Coupon Description -->


          <!-- Eligibility Criteria -->
          <div class="mb-4">
            <label for="editEligibilityCriteria">Eligibility Criteria:</label>
            <select id="editEligibilityCriteria" name="eligibilityCriteria">
              <option value="">Select Eligibility Criterion</option>
              <option value="new-user">New Users</option>
              <option value="amount">Minimum Purchase Amount</option>
              <option value="category">Specific Product Category</option>
              <!-- Add more options as needed -->
            </select>
            <div id="editEligibilityCriteriaError" class="text-danger"></div>

            <div id="editAmountInput" style="display: none;">
              <label for="editCriteriaValue">Amount:</label>
              <input type="number" id="editCriteriaValue" name="criteriaValue" placeholder="Enter amount">
            </div>

            <div id="editCategoryInput" style="display: none;">
              <label for="editCategorySelect">Select Category:</label>
              <select id="editCategorySelect" name="editCategorySelect">
                <option value="">Select Category</option>
                <%for(let i = 0; i < listedCategories.length; i++){%>
                  <option value="<%=listedCategories[i].name%>"><%=listedCategories[i].name%></option>
                  <%}%>
                <!-- Add more categories as needed -->
              </select>
            </div>


            <div id="editCriteriaValueError" class="text-danger"></div>
          </div>
          <!-- End Eligibility Criteria -->
 <!-- Max Discount Amount and Available Coupon Count on the same line -->
 <div class="mb-4">
  <div class="row">
    <div class="col-md-6">
      <label for="editMaxDiscountAmountLabel" class="form-label">Max Discount Amount</label>
      <input type="number" class="form-control" name="maximumDiscount" id="editMaxDiscountAmountLabel" placeholder="Max Discount Amount" aria-label="Max Discount Amount" min="1" />
      <div id="editMaxDiscountAmountError" class="text-danger"></div>
    </div>
    <div class="col-md-6">
      <label for="editAvailableCouponCountLabel" class="form-label">Available Coupon Count</label>
      <input type="number" class="form-control" name="availableCouponCount" id="editAvailableCouponCountLabel" placeholder="Available Coupon Count" aria-label="Available Coupon Count" min="1" />
      <div id="editAvailableCouponCountError" class="text-danger"></div>
    </div>
  </div>
</div>
        </form>
        <!-- End Edit Coupon Form -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="saveChangesBtn">Save Changes</button>
      </div>
    </div>
  </div>
</div>





    <script>
      function listCoupon(id, action) {
        if (action === 'list') {
          $('#modalHead').text('List Coupon');
          $('#listModal').text('List');
          $('#modalbody').text('Are you sure to list this coupon?')
        } else {
          $('#modalHead').text('Unist Coupon');
          $('#listModal').text('Unlist');
          $('#modalbody').text('Are you sure to Unlist this coupon?')
        }
        $('#listCoupon').modal('show');

        $('#listModal').click(async () => {
          try {
            const response = await fetch('/admin/listCoupons', {
              method: 'PATCH',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                id: id
              })
            })

            if (response.status === 200) {
              $('#listCoupon').modal('hide');
              $('#listModal').off('click');
              if (action === 'list') $('#coupon-add').css('display', 'block');
              else $('#coupon-unlist').css('display', 'block');
              setTimeout(() => {
                $('#couponTable1').load('/admin/coupons #couponTable1')
              }, 1000)
            }
          } catch (err) {
            console.log(err);
          }
        })
      }

let couponId;

      function editCoupon(id,code ,discountPercentage, description, date, eligibility, minAmount, category, maxDiscount, totalCount  ){
        couponId = id; 
        const dateObject = new Date(date);
      $('#editAmountInput').hide();
      $('#editCategoryInput').hide();
      const formattedDate = dateObject.toISOString().split('T')[0];
      document.getElementById('editCouponCodeLabel').value=code;
      document.getElementById('editDiscountPercentageLabel').value=discountPercentage;
      document.getElementById('editExpiryDateLabel').value=formattedDate;
      document.getElementById('editCouponDescription').value=description;
      document.getElementById('editEligibilityCriteria').value=eligibility;
      document.getElementById('editMaxDiscountAmountLabel').value=maxDiscount;
      document.getElementById('editAvailableCouponCountLabel').value=totalCount;
   
  
      if(eligibility==='amount'){
        $('#editCategorySelect').val('');
        $('#editCategoryInput').hide();
        $('#editCriteriaValue').val(minAmount);
        $('#editAmountInput').show();
      }else if(eligibility==='category'){
        $('#editCriteriaValue').val('');
        $('#editAmountInput').hide();
        const selectElement = $('#editCategorySelect')[0];
        const categoryRegex = new RegExp(category,'i');
        for (var i = 0; i < selectElement.options.length; i++) {
          
    if (categoryRegex.test(selectElement.options[i].value)) {
      selectElement.options[i].selected = true;
    }
  }
        $('#editCategoryInput').show();
      }else{
        console.log(eligibility);
        $('#editCategorySelect').val('');
        $('#editCriteriaValue').val('');
      }
      $('#coupon-edit-error').css('display','none');
        $('#editCouponModal').modal('show');
      }
      $('#saveChangesBtn').click(async ()=>{
        try{

          if(!validateEditCouponForm())return;
          const code = document.getElementById('editCouponCodeLabel').value;
          const discountPercentage = document.getElementById('editDiscountPercentageLabel').value;
          const expiresOn = document.getElementById('editExpiryDateLabel').value;
          const description =  document.getElementById('editCouponDescription').value;
          const eligibility = document.getElementById('editEligibilityCriteria').value;
          const maximumDiscount =  document.getElementById('editMaxDiscountAmountLabel').value;
          const availableCouponCount =  document.getElementById('editAvailableCouponCountLabel').value;
          const criteriaValue = $('#editCriteriaValue').val();
          const categorySelect =  $('#editCategorySelect').val();
          console.log('wait');
         const response = await fetch('/admin/editCoupon',{
            method:'PATCH',
            headers:{
              'Content-Type': 'application/json',
            },
            body:JSON.stringify({
              couponId,code,discountPercentage,expiresOn,description,eligibility,maximumDiscount,availableCouponCount,criteriaValue,categorySelect

            })
          })
          if(response.status===200){
            $('#reloadTable').load('/admin/coupons #reloadTable')
            $('#editCouponModal').modal('hide');
            $('#coupon-add').css('display','block');
            setTimeout(()=>{
              $('#coupon-add').css('display','none');
            },1000);
          }
          if(response.status===409){
            $('#coupon-edit-error').css('display','block');
          }
        }catch(err){
          console.log(err);
        }
            })
      
      



            function validateEditCouponForm() {
  // Reset previous errors
  document.getElementById('editCouponCodeError').innerText = '';
  document.getElementById('editDiscountPercentageError').innerText = '';
  document.getElementById('editCouponDescriptionError').innerText = '';
  document.getElementById('editExpiryDateError').innerText = '';
  document.getElementById('editEligibilityCriteriaError').innerText = '';
  $('#editCriteriaValueError').text('');
  document.getElementById('editMaxDiscountAmountError').innerText = '';
  document.getElementById('editAvailableCouponCountError').innerText = '';

  // Get form values
  const couponCode = document.getElementById('editCouponCodeLabel').value;
  const discountPercentage = document.getElementById('editDiscountPercentageLabel').value;
  const expiryDate = document.getElementById('editExpiryDateLabel').value;
  const couponDescription = document.getElementById('editCouponDescription').value;
  const eligibilityCriteria = document.getElementById('editEligibilityCriteria').value;
  const maximumDiscount = document.getElementById('editMaxDiscountAmountLabel').value;
  const availableCouponCount = document.getElementById('editAvailableCouponCountLabel').value;
  const amountInput = $('#editCriteriaValue').val();
  const categoryInput = $('#editCategorySelect').val();
  const expiry = new Date(expiryDate);
  expiry.setHours(0, 0, 0, 0);

  let isValid = true;
  

  if (!couponCode.trim()) {
    document.getElementById('editCouponCodeError').innerText = 'Coupon Code is required';
    isValid = false;
  }

  if (discountPercentage < 1 || discountPercentage > 100) {
    document.getElementById('editDiscountPercentageError').innerText = 'Please provide a valid discount percentage';
    isValid = false;
  }
  const date = new Date();
  date.setHours(0,0,0,0);
  if (!expiryDate || expiry < date) {
    document.getElementById('editExpiryDateError').innerText = 'Please provide a valid date';
    isValid = false;
  }

  if (!couponDescription.trim()) {
    document.getElementById('editCouponDescriptionError').innerText = 'Coupon description is required';
    isValid = false;
  }

  if (!eligibilityCriteria.trim()) {
    document.getElementById('editEligibilityCriteriaError').innerText = 'Please provide an eligibility criteria';
    isValid = false;
  }

  const selectedCriterion = document.getElementById('editEligibilityCriteria').value;
  if (selectedCriterion === 'amount') {
    if (amountInput < 1 || amountInput > 100000) {
      document.getElementById('editCriteriaValueError').innerText = 'Please enter a valid amount between 1 and 1000000';
      isValid = false;
    }
  } else if (selectedCriterion === 'category') {
    if (!categoryInput.trim()) {
      document.getElementById('editCriteriaValueError').innerText = 'Please select a category';
      isValid = false;
    }
  }

  if (maximumDiscount < 1 || maximumDiscount > 500) {
    document.getElementById('editMaxDiscountAmountError').innerText = 'Please enter a valid amount between 1 and 500';
    isValid = false;
  }

  if (availableCouponCount < 1) {
    document.getElementById('editAvailableCouponCountError').innerText = 'Please enter a valid count';
    isValid = false;
  }
console.log(isValid);
  // If all validations pass, the form will be submitted
  return isValid;
}

    </script>

<script>
  $(document).ready(function () {
    // Handle eligibility criteria change event
    $('#editEligibilityCriteria').change(function () {
      // Get the selected eligibility criterion
      const selectedCriterion = $(this).val();

      // Hide all input fields by default
      $('#editAmountInput, #editCategoryInput').hide();

      // Show the input field based on the selected criterion
      if (selectedCriterion === 'amount') {
        $('#editAmountInput').show();
      } else if (selectedCriterion === 'category') {
        $('#editCategoryInput').show();
      }
    });

    // Set the minimum expiry date to the current date
    $('#editExpiryDateLabel').attr('min', getCurrentDate());

    function getCurrentDate() {
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, '0');
      const mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
      const yyyy = today.getFullYear();

      return `${yyyy}-${mm}-${dd}`;
    }
  });
</script>


</body>

</html>